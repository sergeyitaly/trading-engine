# Trading Engine for Bybit/Gate.io

A Python-based trading engine that connects to Bybit or Gate.io testnet, opens positions based on JSON configuration, handles position averaging, and implements dynamic take-profit orders.

---

What it does:

1. Exchange Connection
   âœ… Uses CCXT with proper error handling
   âœ… Supports both Bybit and Gate.io exchanges
   âœ… Works with testnet/mainnet environments
   âœ… Connection pooling with aiohttp for performance
   âœ… Timeout and retry mechanisms

2. Order Opening & Configuration
   âœ… Handles market order execution with position sizing
   âœ… Configurable via Pydantic models (TradingConfig)
   âœ… Supports both long and short positions
   âœ… Leverage setting with error handling
   âœ… **Flexible Config Loading**: Load `config.json` from local storage **or** parse configuration directly from a URL

3. Averaging Logic
   âœ… Places limit orders in specified range
   âœ… Calculates proper order distribution
   âœ… Handles market precision rounding
   âœ… Updates position info when averaging orders fill

4. TP Logic
   âœ… Calculates TP prices based on average entry price
   âœ… Supports multiple TP levels with percentage allocation
   âœ… Replaces TP orders when position changes (not just adding new ones)
   âœ… Uses reduceOnly flag for safety

5. Monitoring
   âœ… Continuous position monitoring loop
   âœ… Order status checking
   âœ… Periodic position updates
   âœ… Console logging with proper formatting

ğŸ“Š Real-Time Capabilities
âœ… WebSocket Support: Live updates for status, orders, and positions
âœ… Broadcast System: Real-time notifications to all connected clients
âœ… Connection Management: Automatic cleanup of disconnected WebSocket clients
âœ… Multi-Client Support: Simultaneous dashboard/UI connections

2ï¸âƒ£ Credentials
.env file: Set your API keys and secrets in a .env file.
Manual input: Enter credentials at runtime if you prefer not to store them in a file.

---

## âœ… Current Status

* **Main application (`main.py`)** is **complete and production-ready**:

  * âœ… Config loading from JSON
  * âœ… Config parsing from URL or local storage
  * âœ… Exchange connection initialization
  * âœ… Main trading loop execution
  * âœ… Proper error handling and cleanup
  * âœ… Async runtime management

* **GitHub Actions CI/CD Pipeline**
  Our automated pipeline ensures production readiness on every commit to `main`/`master`:

  * âœ… Python version compatibility checks (3.11.9)
  * âœ… Code formatting (Black)
  * âœ… Linting (Flake8)
  * âœ… Static type checking (mypy)
  * âœ… Unit + integration tests with coverage
  * âœ… Docker image build & container health checks
  * âœ… Kubernetes manifest validation (`kubeval`)
  * âœ… Security scans (Dependency Review + Gitleaks)

---

## Features

* Connects to Bybit or Gate.io testnet using CCXT
* Opens market positions based on configuration
* **Configuration Sources**:

  * `config.json` file from local storage
  * URL-based configuration parsing (e.g. `http://example.com/config.json`)
* Places limit orders for position averaging
* Implements dynamic take-profit orders that update when averaging occurs
* Monitors positions and order status
* REST API for control and monitoring
* Streamlit UI for dashboard visualization
* Docker containerization
* Comprehensive logging

---

## Installation

### Local Development

```bash
git clone <repository-url>
cd trading-engine

pyenv local 3.11.9
python -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### Run Services

```bash
# Start FastAPI backend
uvicorn app.api:app --reload --host 0.0.0.0 --port 8000

# Start Streamlit dashboard
streamlit run app/ui/dashboard.py
```

### Docker (alternative)

```bash
docker-compose down
docker-compose up --build
```

---

## Configuration

You can provide your trading configuration in one of two ways:

1. **Local file**: Place a `config.json` file in the project root or specify its path.
2. **URL**: Pass a config URL (e.g. `http://example.com/config.json`) to the engine. The system will fetch and parse it automatically.

This flexibility makes it easy to share or test different setups without changing the codebase.

---

## Testing

Run all unit tests:

```bash
python run_tests.py
```

Run integration tests:

```bash
python run_tests.py --run-integration
```

Run a specific test file:

```bash
python -m pytest tests/test_trading_engine.py -v
```

Run with coverage:

```bash
python -m pytest tests/ --cov=app --cov-report=html --cov-report=term
```

---

## Deployment

* **Docker image** can be built and deployed directly:

  ```bash
  docker build -t trading-engine:latest .
  docker run -p 8000:8000 -p 8501:8501 trading-engine:latest
  ```
* **Kubernetes manifests** available under `k8s/`, validated with `kubeval`.
* **Fly.io** deployment supported with `fly.toml`.

---

## CI/CD Badges

*(Optional: add GitHub Actions & Codecov badges here once pipeline is public)*

---

## Positive Aspects to Highlight About Our Trading Engine API

### ğŸš€ **Performance & Scalability**

* Async-first architecture (FastAPI)
* Connection pooling & aiohttp
* GZip compression
* Timeout protection
* CORS enabled

### ğŸ”’ **Security & Reliability**

* Thread-safe engine lock
* Secure credential handling
* Validation-first design
* Graceful shutdown
* Error isolation

### ğŸ“Š **Real-Time Capabilities**

* WebSocket updates
* Broadcast system
* Connection cleanup
* Multi-client support

### âš¡ **User Experience**

* Fast response times
* Validation mode (dry run)
* Config hot-reload
* Health monitoring

### ğŸ”§ **Developer Friendly**

* RESTful API
* WebSocket integration
* Detailed logging
* Full type hints
* Modular structure

### ğŸŒ **Exchange Integration**

* Bybit & Gate.io support
* Testnet/Mainnet toggle
* Automatic leverage handling
* Market precision awareness

### ğŸ“ˆ **Trading Features**

* Position averaging (DCA)
* Dynamic TP/SL updates
* Order lifecycle management
* Built-in risk management

### ğŸ›¡ï¸ **Robustness**

* Timeout resilience
* Error recovery
* Memory safety
* Concurrent safe

### ğŸ¯ **Production Ready**

* UVicorn deployment
* Middleware stack
* Monitoring ready
* Scalable architecture

### ğŸ”„ **Workflow Optimization**

* Background processing
* Dynamic config updates
* Session persistence
* Batch operations

### ğŸ“Š **Analytics & Visibility**

* Performance metrics
* Real-time activity monitoring
* Order history tracking
* WebSocket events

### ğŸ’¡ **Innovative Features**

* Validation-only mode
* Multiple credential sources
* Automatic symbol resolution
* Precision handling

This API provides a **professional-grade trading infrastructure** that combines robust engineering with trader-friendly features, making it suitable for both individual traders and institutional use.
